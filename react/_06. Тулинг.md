# Тулинг

## Проблема

Раньше при разработке многое делалось руками: файлы копировались туда-сюда, пробелы и отступы расставлялись и так далее.
Причём кто во что был горазд: один ставит 2 пробела отступа, другой 4, третий вообще табы использует.
А кто-то вообще не запаривается, и его код становится похожим на нечто такое:

![](https://i.imgur.com/7nJRNtl.png?1)
*Жизнь без Преттира и Еслинта*

Как это читать – хз. Добавьте к этому споры между разработчиками про то, нужно ли ставить точку с запятой или нет.
Помимо этого есть общепринятые best practices о том, как правильно и неправильно писать код. Раньше это все выливалось в долгие обсуждения во время ревью кода.

Но спустя время были придуманы различные инструменты, которые нужно один раз настроить и которые дальше будут автоматически форматировать и проверять наш код. О них и поговорим далее.

## Prettier

[Преттир](https://prettier.io/) это форматтер кода. Он отвечает за то, чтобы у всех разработчиков был код с одинаковыми отступами, по одинаковому стайлгайду. Больше никаких споров про отступы, переносы, запятые с точками и прочее.

Работает он так: вы ставите `prettier` как зависимость и в файле конфига задаете настройки, по которым он работает. С имеющимися настройками можно ознакомиться [тут](https://prettier.io/docs/en/options), но в целом можно просто всегда брать уже готовый recommended конфиг.

Преттир является стандартом во фронтенде и мастхэв абсолютно в каждом проекте.

## ESLint

[Еслинт](https://eslint.org/) это утилита, которая анализирует ваш код по заданным правилам.

Работает он по тому же принципу, что и Преттир – вы ставите `eslint` как зависимость и в [файле конфига](https://eslint.org/docs/latest/use/configure/configuration-files-deprecated) задаёте настройки, по которым он работает.

Это тоже мастхэв в любом проекте, без Еслинта никуда.

## Интеграция с IDE

Что Преттир, что Еслинт – консольные утилиты. Они запускаются такими командами из консоли, как `npx prettier --write .` (опция `--write` указывает Преттиру, чтобы он отформатировал код и сохранил изменения, `.` – означает пройтись по всем файлам) и `npx eslint --fix .` (здесь `--fix` – то же самое, что и `--write` у Преттира).
Чтобы не запускать руками эти команды каждый раз, есть специальные плагины для IDE, которые делают это в фоне на каждое изменение в коде или на save.

Например, для Вскода есть плагины [`dbaeumer.vscode-eslint`](https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint) и [`esbenp.prettier-vscode`](https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode).

А в Вебшторме они уже встроены в саму IDE.

Все, что достаточно сделать, – это настроить интеграцию этих плагинов с вашими Преттиром и Еслинтом из зависимостей.

---

В целом, это 2 самых главных инструмента, которые вы будете использовать абсолютно всегда, когда пишете код. Теперь давайте настроим это все в нашем проекте.

## Настроим наш проект

Итак, с прошлого урока у нас остался проект, в котором мы настроили parcel, добавили первый реакт компонент `App` и отрендерили его в `index.html`.
Его и будем настраивать.

> Небольшой спойлер: так как настройка для джаваскрипта и тайпскрипта отличается, мы будем сразу настраивать все для работы с тайпскриптом.

### Typescript

Тайпскрипт это как джаваскрипт, только с нормальной типизацией, как в других языках. О нем подробнее будет в одном из следующих уроков. Пока что просто установим его в проект.

```shell
npm i --save-dev typescript
```

### ESLint

Дальше настроим Еслинт, Ставим как зависимость eslint и все, что с ним связано

```shell
npm i --save-dev eslint typescript-eslint @eslint/js @types/eslint__js
```

Создаем файл конфига `eslint.config.js` и экстендим recommended конфиги

```js
// @ts-check

import eslint from "@eslint/js";
import tseslint from "typescript-eslint";

export default tseslint.config(
  {
    files: ["**/*.js", "**/*.jsx", "**/*.ts", "**/*.tsx"],
    extends: [
      eslint.configs.recommended,
      ...tseslint.configs.recommended,
      ...tseslint.configs.recommendedTypeChecked,
    ],
    languageOptions: {
      parserOptions: {
        project: true,
      },
    },
  },
  {
    files: ["**/*.js", "**/*.jsx"],
    ...tseslint.configs.disableTypeChecked,
  }
);

```

Здесь все просто: `teslint.config` – функция хелпер для того, чтобы автокомплит работал, в `files` указываем какие файлы нужно линтить, в поле `extends` указываем какие конфиги (из готовых) мы берем в проект, 

Проверяем, что всё работает
```shell
eslint .
```

### Prettier

[Преттир](https://prettier.io/) это форматер кода. Больше никаких споров про отступы, переносы, запятые с точками и прочее.

### Настройка Вскода для проекта

Поставьте два плагина: [`dbaeumer.vscode-eslint`](https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint) и [`esbenp.prettier-vscode`](https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode).

#### Настройки вскода

Эти настройки идут в дополнение к вашим, а не полностью их заменяют. Разбирать их не буду, из значений, думаю, понятно что к чему относится, но если нет — не забудьте в чате прояснить.

```javascript
{
  "editor.tabSize": 2,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.formatOnSave": true,
  "javascript.updateImportsOnFileMove.enabled": "always",
  "typescript.updateImportsOnFileMove.enabled": "always",
}
```

#### Настройка Еслинта и Преттира в проекте

В вскоде мы настроили плагины, это все нужно для нашего удобства.
Они работают уже прямо сейчас у нас в редакторе.
Но что если не все пользуются вскодом?
Или, например, мы хотим запускать еслинт и преттир вообще на другой машине,
где вообще нет ни вскода, ни вебшторма? Ответ прост – нужно сделать так,
чтобы все эти тулзы стояли не только как плагины вашей IDE, но и в целом в проекте.
Поэтому делаем:

```shell
npm i --save-dev prettier eslint eslint-config-prettier
```
* `prettier` и `eslint` – собственно сами приттир и еслинт
* `eslint-config-prettier` – штука, чтобы отключить форматирование линтером. Раньше многие конфиги еслинта еще и код форматировали впридачу, причем делали это коряво и зачастую конфликтовали с приттиром. Поэтому разработчики придумали так: все, что относится к форматированию, делает приттир, все остальное – еслинт. А чтобы еслинт даже не думал трогать пробелы и отступы, `eslint-config-prettier` просто отключает подобные правила, оставляя все форматирование на плечах преттира

Осталось все это связать конфигом, можете просто взять этот для начала. В корне проекта создайте файл `.eslintrc.js`
```js
module.exports = {
  extends: ['eslint:recommended', 'plugin:@typescript-eslint/recommended', 'eslint-config-prettier'], // eslint-config-prettier всегда должен стоять последним в списке
  parser: '@typescript-eslint/parser',
  plugins: ['@typescript-eslint'],
  root: true,
};
```

И наконец, добавим скрипты в блок `"scripts"` `package.json`, чтобы удобно все это запускать:
```json
...
"lint": "eslint ./**/*",
"lint:fix": "eslint --fix ./**/*",
"format": "prettier --write ./**/*"
...
```

Отдельно по каждому пояснять не буду, думаю и так понятно, что они делают. Можете отдельно позапускать их командами `npm run <script_name>` или прямо из вскода.
