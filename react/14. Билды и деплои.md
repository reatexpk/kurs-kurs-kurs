# Билды и деплои

Разрабатывать локально это прикольно, но интерфейсом должны пользоваться другие люди, верно?

Раньше всё было легко — воткнул джс в тег `<script>`, залил через ФТП и получил новый сайт. Сейчас всё стало сложнее:

- во-первых, мы используем rollup (под капотом у Vite), чтобы компилировать код из нового стандарта в тот, что поддерживается браузерами сейчас;
- во-вторых, нужно минифицировать код;
- в-третьих, rollup должен разбираться со всеми импортами: мы же не положим картинку в джс-файл, хоть мы её и импортим там?

Для этого существует шаг **билда**.

## Билд

Билд (build) это этап сборки проекта: когда весь проект собирается в продакшен версию.

Продакшен это один из видов окружения: места, где работает ваш код. Во фронтэнде продакшен-версия обычно означает, что файлы будут минифицированы, сжаты через какой-нибудь gzip, вырезаны лишние проверки, благодаря этому уменьшен код и так далее. Почитайте в [доке Vite](https://vitejs.dev/guide/features.html#build-optimizations) — там об этом хорошо рассказано.

Билдится проект через `vite build` (эта команда уже записана в `package.json` под `build` благодаря Vite и поэтому можно вызвать как `npm build`), после билда у вас будет директория `dist` с файлами: `index.html` в корне, в `assets` — `index-[hash].js`, `index-[hash].css` и так далее.

Если вы откроете файл `dist/index.html` в браузере, то вы получите белый экран и ошибку в консоли, что файлы .css и .js не найдены. Почему так?

### `PUBLIC_URL`

Если вы почитаете [документацию Vite](https://vitejs.dev/guide/#index-html-and-project-root), то заметите такую строку: "Vite has the concept of a "root directory" which your files are served from"

Это означает, что dist является той самой root directory. Именно эта директория должна потом лежать на сервере http сервера (например, на вашем хостинге)

А в билд версии `index.html` все урлы будут относительными. Например, если у вас домен "https://erodionov.ru"

```html
<script type="module" crossorigin="" src="/assets/index-DVoHNO1Y.js"></script> <!-- Будет ссылаться на https://erodionov.ru/assets/index-DVoHNO1Y.js -->
<link rel="stylesheet" crossorigin="" href="/assets/index-DiwrgTda.css"> <!-- Будет ссылаться на https://erodionov.ru/assets/index-DiwrgTda.css -->
```

---

Окей, с паблик урл разобрались, с билдом тоже — в `build` мы получаем готовую **статику**, а что делать с этим дальше? Люди же не будут заходить к вам на ноутбук и искать директорию билд.

## Деплой

[Деплой](https://vitejs.dev/guide/static-deploy.html) (deploy) это процесс **выкатки обновлений**.

Что делать с билдом? Его нужно куда-нибудь **залить**, чтобы он был доступен по **адресу** (ХТТП).

Интернет делится на несколько вещей, давайте поработаем через аналогии с городом:

- **хостинг** — это библиотека,
- **домен** — адрес библиотеки,
- **ДНС** — карта города

Хостинг — это сервер, где находится ваш сайт (или база данных, или контр-страйк сервер или ещё что-то).

Домен — адрес к этому серверу.

> Конечно же, на одном сервере может быть несколько доменов привязанных — для этого используют веб-сервер (типа [nginx](https://www.nginx.com/)), который указывает, что по адресу `x.com` нужно показать контент из директории `/www/x.com`, а по адресу `y.com` нужно отправлять запросы на локальное приложение, которое находится на порте 1234. Об этом будем разбирать в следующем уроке.

По ДНСу браузер (или любой другой клиент) определяет, на какой сервер нужно сходить по домену. ДНС это каталог, так сказать.

---

Что нам дали эти знания? Нам нужно залить сайт на **хостинг**, к которому будет привязан **домен** через **ДНС**.

В [документации](https://vitejs.dev/guide/static-deploy.html) Vite указаны множество способов задеплоить приложение, используя разные инструменты, такие как Github Pages или Netlify.

## Сервисы деплоя

Но, согласитесь, деплоить руками даже через команду `ntl deploy` как-то не очень удобно: сначала коммит, потом пуш, потом ещё и задеплоить.

Было бы удобно, если бы проект сам собирался и деплоился бы при пуше в репозиторий! Такой подход называется Continuous Deployment (на самом деле их аж три: [Continuous integration vs. continuous delivery vs. continuous deployment](https://www.atlassian.com/continuous-delivery/ci-vs-ci-vs-cd)).

Один из вариантов, которые предлагает Vite — [Netlify with Git](https://vitejs.dev/guide/static-deploy.html#netlify-with-git).

Подробнее об этом можно почитать в документации Vite и Netlify в частности.

## Итог

В этом уроке вы познакомились с билдами, деплоями, окружениями, немного копнули даже в хостинги-днсы и узнали про сервисы деплоя.
